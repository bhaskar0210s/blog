<!DOCTYPE html>
<html lang="en">
  <head>
    <script>
      // Prevent theme flicker by applying theme immediately
      (function () {
        try {
          const storedTheme = localStorage.getItem("theme") || "auto";
          const html = document.documentElement;

          // Apply theme immediately
          html.setAttribute("data-theme", storedTheme);

          // For auto theme, check system preference
          if (storedTheme === "auto") {
            const prefersDark = window.matchMedia(
              "(prefers-color-scheme: dark)"
            ).matches;
            if (prefersDark) {
              html.classList.add("auto-dark");
              html.classList.remove("auto-light");
            } else {
              html.classList.add("auto-light");
              html.classList.remove("auto-dark");
            }
          }

          // Update meta theme-color
          const colors = {
            light: "#ffffff",
            dark: "#1a1a1a",
            auto: window.matchMedia("(prefers-color-scheme: dark)").matches
              ? "#1a1a1a"
              : "#ffffff",
          };

          let metaThemeColor = document.querySelector(
            'meta[name="theme-color"]'
          );
          if (metaThemeColor) {
            metaThemeColor.content = colors[storedTheme] || colors.auto;
          }
        } catch (e) {
          // Fallback to light theme if localStorage fails
          document.documentElement.setAttribute("data-theme", "light");
        }
      })();
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      {% if page.title %}{{ page.title }} - {% endif %}{{ site.title }}
    </title>
    <meta
      name="description"
      content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}"
    />
    <meta name="theme-color" content="#ffffff" />
    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}" />
    <link rel="canonical" href="{{ page.url | absolute_url }}" />
    <link
      rel="alternate"
      type="application/rss+xml"
      title="{{ site.title }}"
      href="{{ '/feed.xml' | relative_url }}"
    />
    <script src="{{ '/assets/js/theme.js' | relative_url }}" defer></script>
    <script>
      // Update note theme adaptation and positioning
      function updateNoteTheme() {
        const updateNote = document.querySelector(".update-note");
        if (!updateNote) return;

        const isDark =
          document.documentElement.getAttribute("data-theme") === "dark" ||
          document.documentElement.classList.contains("auto-dark");

        if (isDark) {
          updateNote.style.color = "#808080";
        } else {
          updateNote.style.color = "#999999";
        }
      }

      function positionUpdateNote() {
        const updateNote = document.querySelector(".update-note");
        const siteHeader = document.querySelector(".site-header");

        if (!updateNote || !siteHeader) return;

        const headerRect = siteHeader.getBoundingClientRect();
        const headerCenter = headerRect.top + headerRect.height / 2;
        const noteHeight = updateNote.offsetHeight;

        // Position the note at the center of the header, accounting for its own height
        updateNote.style.top = headerCenter - noteHeight / 2 + "px";
      }

      // Run on load and when theme changes
      document.addEventListener("DOMContentLoaded", function () {
        updateNoteTheme();
        positionUpdateNote();
      });

      document.addEventListener("themeChanged", updateNoteTheme);

      // Also check periodically for theme changes and reposition on scroll/resize
      setInterval(function () {
        updateNoteTheme();
        positionUpdateNote();
      }, 1000);

      // Reposition on scroll and resize
      window.addEventListener("scroll", positionUpdateNote);
      window.addEventListener("resize", positionUpdateNote);
    </script>
  </head>
  <body>
    <span
      class="update-note"
      style="
        position: fixed;
        top: 1rem;
        left: 10px;
        font-size: 0.7rem;
        color: #999999;
        opacity: 0.7;
        font-weight: 300;
        letter-spacing: 0.3px;
        z-index: 1000;
        margin: 0;
        display: inline-block;
        font-style: italic;
      "
      >ðŸš€ Rapidly updating</span
    >
    <header class="site-header">
      <div class="container">
        <nav class="site-nav">
          <a href="{{ '/' | relative_url }}" class="site-title"
            >{{ site.title }}</a
          >
          <ul class="nav-links">
            <li><a href="{{ '/' | relative_url }}">Home</a></li>
            <li><a href="{{ '/posts.html' | relative_url }}">Posts</a></li>
            <li>
              <a href="https://bhaskar0210s.github.io/me/" target="_blank"
                >About</a
              >
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <main class="main-content">
      <div class="container">{{ content }}</div>
    </main>

    <footer class="site-footer">
      <div class="container">
        <p>
          &copy; {{ 'now' | date: "%Y" }} {{ site.author }}. All rights
          reserved.
        </p>
      </div>
    </footer>
  </body>
</html>
